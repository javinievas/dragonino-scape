<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ranking Dragonino Scape</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
</head>
<body class="bg-light">
  <div class="container my-5">
    <h1 class="text-center mb-4">Ranking Escape Room</h1>

    <div id="rankings">
      <div class="mb-5">
        <h2>Ranking de Hoy</h2>
        <ul class="list-group" id="ranking-hoy"></ul>
      </div>

      <div class="mb-5">
        <h2>Ranking del Ãšltimo Mes</h2>
        <ul class="list-group" id="ranking-mes"></ul>
      </div>

      <div>
        <h2>Ranking Global</h2>
        <ul class="list-group" id="ranking-global"></ul>
      </div>
    </div>
  </div>

  <script>
    const GIST_ID = "153d85038e8b0f8e3d55295b8195e36e";
    const FILENAME = "ranking.json";

    function formatearTiempo(segundos) {
      const minutos = Math.floor(segundos / 60);
      const restoSegundos = segundos % 60;
      return `${minutos}m ${restoSegundos}s`;
    }

    function renderRanking(equipos, filtro, idDestino) {
      const listaFiltrada = equipos
        .filter(filtro)
        .sort((a, b) => a.tiempoSegundos - b.tiempoSegundos);

      const ul = document.getElementById(idDestino);
      ul.innerHTML = "";

      if (listaFiltrada.length === 0) {
        ul.innerHTML = '<li class="list-group-item">Sin datos</li>';
        return;
      }

      listaFiltrada.forEach((equipo, index) => {
        const li = document.createElement('li');
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.innerHTML = `<span>#${index + 1} - ${equipo.nombre}</span><span>${formatearTiempo(equipo.tiempoSegundos)}</span>`;
        ul.appendChild(li);
      });
    }

    async function cargarDatos() {
      const url = `https://gist.githubusercontent.com/raw/${GIST_ID}/${FILENAME}`;
      try {
        const response = await fetch(url);
        const equipos = await response.json();
        const hoy = dayjs().format('YYYY-MM-DD');
        const haceUnMes = dayjs().subtract(1, 'month');

        renderRanking(equipos, e => e.fecha === hoy, 'ranking-hoy');
        renderRanking(equipos, e => dayjs(e.fecha).isAfter(haceUnMes), 'ranking-mes');
        renderRanking(equipos, () => true, 'ranking-global');
      } catch (err) {
        alert("Error cargando datos del ranking.");
        console.error(err);
      }
    }
    cargarDatos();
  </script>
</body>
</html>
